ğŸŸ  Phase 2 â€” Reliability & Correctness Improvements
6) Remove throw in error handler
Why: It can crash the server after responding.
File: server/index.ts
Actions:
Remove the throw err line in error handler.
ğŸ“ Target: server/index.ts error handler.
7) Add request validation for write endpoints
Why: req.body is passed directly to storage (risk of malformed data).
Files: server/routes.ts, shared/schema.ts
Actions:
Use drizzle-zod or zod schemas from shared/schema.ts.
Validate and whitelist fields for:
/api/profile update
/api/flaps create/update
/api/anastomoses create/update
ğŸ“ Targets:
Routes in server/routes.ts.
Schemas in shared/schema.ts.
8) Add timeouts for SNOMED API fetches
Why: External fetches can hang.
File: server/snomedApi.ts
Actions:
Use AbortController to set a timeout (e.g., 8s) for fetch.
ğŸ“ Target: server/snomedApi.ts in searchProcedures, searchDiagnoses, getConceptDetails.
ğŸŸ¡ Phase 3 â€” Performance Improvements
9) Avoid creating a new OCR worker per request
Why: Each request creates/terminates Tesseract worker.
File: server/ocr.ts
Actions:
Implement a simple worker pool or reusable singleton.
ğŸ“ Target: server/ocr.ts.
10) Reduce AsyncStorage full-array rewrites
Why: Reads/writes full case array; scales poorly.
File: client/lib/storage.ts
Actions:
Move to per-case keys or migrate to SQLite; add indexes for procedureDate and patientIdentifier.
ğŸ“ Target: client/lib/storage.ts.
ğŸŸ¢ Phase 4 â€” Junk / Dead Code Cleanup
11) Remove unused Replit integrations
Why: Not registered in server; unused dependencies.
Files: server/replit_integrations/*, client/replit_integrations/*, package.json
Actions:
Delete those directories.
Remove dependencies: openai, @google/genai, p-limit, p-retry, ws, http-proxy-middleware if not used elsewhere.
ğŸ“ Targets:
server/replit_integrations/... (not registered).
Dependencies list in package.json.
12) Remove unused prompt artifacts
Why: Old prompt files add noise.
File: attached_assets/Pasted-*.txt
Actions: Remove them.
ğŸ“ Target: attached_assets/Pasted-This-is-a-pivotal-moment-...txt.

ğŸŸ£ Phase 5 â€” Documentation Alignment
13) Update privacy statement to match actual behavior
Why: README says â€œ100% offlineâ€ but native sends images to server.
File: replit.md
Actions:
Either adjust implementation or update doc to explicitly state when data leaves device.
ğŸ“ Target: replit.md privacy section.
âœ… Optional Additions (If Time)
14) Add rate limiting on auth endpoints
Why: Prevent brute force.
File: server/routes.ts
Actions: Add middleware to /api/auth/signup and /api/auth/login.
ğŸ“ Target: server/routes.ts auth routes.

15) CI workflow
Why: Basic lint/type checks.
Files: new .github/workflows/ci.yml, package.json
Actions: Add workflow with npm ci, npm run lint, npm run check:types.
ğŸ“ Targets: package.json scripts already exist.

