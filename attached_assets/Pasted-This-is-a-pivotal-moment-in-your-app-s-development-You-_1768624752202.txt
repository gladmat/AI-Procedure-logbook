This is a pivotal moment in your app's development. You are moving from a **"Single-Player"** tool (purely local, privacy-safe) to a **"Multiplayer-Ready"** platform (Teams, Verification, Sync).

To achieve "Team Functionality" later, we must introduce a **Cloud Backend** for Identity (User Accounts), while keeping the **Clinical Data** locally encrypted (Local-First) until the user explicitly chooses to share it.

Here is the **Master Prompt for Replit**. It instructs the AI to set up **Supabase** (the standard standard backend for Replit apps) to handle the secure user management, while preparing the database schema for the specific medical verification needs you described.

### **How to Use This**

1. **Open your Replit Project.**
2. **Paste this prompt** into the Agent chat.
3. **Important:** The Agent will likely ask you to "Connect Supabase" or "Add Secrets". Follow its buttons to create a free Supabase projectâ€”it handles the connection automatically.

---

### **Project Upgrade: ReconLog V8 - Identity, Settings & Team Architecture**

**1. Executive Summary**
Upgrade the **ReconLog** application from a purely local prototype to a **Hybrid Architecture** with User Authentication.

* **Goal:** Allow users to create accounts, define their professional profile (Country, Career Stage, Hospitals), and prepare the database for future Team/Sharing functionality.
* **Constraint:** Maintain "Local-First" performance for clinical logs, but use **Supabase (PostgreSQL)** for User Identity and Profile Settings.

**2. Tech Stack Upgrade**

* **Auth:** Supabase Auth (Email/Password + Social Login).
* **Database:** Supabase PostgreSQL (for User Profiles & Team Metadata).
* **Frontend:** React (continue with existing).

**3. Database Schema: The "Profile" Layer**
*Create a `profiles` table in Supabase that automatically links to the `auth.users` table.*

**Table: `profiles**`

* `id`: UUID (Primary Key, references `auth.users.id`).
* `full_name`: String.
* `country_of_practice`: Enum (`"New Zealand"`, `"Poland"`, `"Australia"`, `"Other"`).
* *Logic:* This field determines which validation logic applies later (e.g., NHI vs PESEL validation).


* `medical_council_number`: String (Nullable).
* *Context:* Stores the **MCNZ Number** (if NZ) or **PWZ Number** (if PL).
* *Verification Status:* Enum (`"Unverified"`, `"Pending"`, `"Verified"`). Default to "Unverified".


* `career_stage`: Enum.
* *Options:* `"Junior House Officer"`, `"Registrar (Non-Training)"`, `"SET Trainee"`, `"Fellow"`, `"Consultant/Specialist"`, `"MOSS"`.


* `created_at`: Timestamp.

**Table: `user_facilities` (Many-to-Many)**

* *Context:* A surgeon works at multiple hospitals.
* `id`: UUID.
* `user_id`: Foreign Key (`profiles.id`).
* `facility_name`: String (e.g., "Waikato Hospital").
* `is_primary`: Boolean (Default false).

**4. Feature Specification: The "Onboarding Wizard"**
When a user logs in for the first time, guide them through a 3-step setup (do not let them access the logbook until this is done).

* **Step 1: Jurisdiction**
* Select Country: [New Zealand / Poland / Other].
* *UI Logic:* If NZ is selected, change label of ID field to "MCNZ Number". If PL, change to "Numer PWZ".


* **Step 2: Professional Status**
* Select Career Stage (Dropdown).
* Enter Full Name (for future Team Reports).


* **Step 3: Workplace**
* "Where do you operate?"
* Input field with "Add" button to build a list of facilities (e.g., "Waikato Hospital", "Braemar Hospital").
* *Why:* These will auto-populate the "Facility" dropdown in the Add Case form later.



**5. Future-Proofing (Team Functionality Prep)**

* **Team Schema (Draft Only):** Create a `teams` table and `team_members` table in the database definition, even if not used in the UI yet.
* **Shared Logs Logic:** Add a `team_id` column (Nullable UUID) to the local `Cases` schema.
* *Comment:* This prepares the app so that if `team_id` is present, the app knows this case belongs to a shared logbook, not just the private one.



**6. Implementation Steps for Replit**

1. Install `@supabase/supabase-js`.
2. Set up the Auth Provider context in React.
3. Create the **Login/Sign Up Page** (Clean, Medical Blue theme).
4. Create the **Settings Page** (allows editing the profile data defined above).
5. Update the **"Add Case" Form**:
* The "Facility" dropdown should now pull from the user's `user_facilities` list instead of being a blank text box.



---

### **Why this specific structure?**

1. **Country as a "Switch":** By saving the country (`country_of_practice`) now, we can write code later that says: *"If User is in NZ, check valid NHI format. If PL, check PESEL."*
2. **Facilities List:** Instead of typing "Waikato Hospital" 500 times a year, you type it once in settings, and it becomes a quick dropdown in your daily workflow.
3. **Verification Ready:** We added the `medical_council_number` field now. Later, we can add an API call to the MCNZ register to auto-verify you, turning that "Unverified" status to "Verified" (Green Tick).